<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <script type="text/javascript" src="d3/d3.js"></script>
        <link rel="stylesheet" href="styles.css">
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.0/jquery.min.js"></script>
    </head>
    <body>
        <script type="text/javascript">
            d3.select("head").append("title").text("Bar Chart")

            d3.select("body").style("text-align", "center").style("font-family", "sans-serif").append("h1").text("Bar Chart")

            d3.select("h1").style("color", "lightblue")

            d3.select("body").append("h2").text("Max Frings").style("color", "lightblue");

            d3.select("body").append("h3").text("10544429").style("color", "lightblue");

            d3.select("body").append("p").text("Ozone concentrations in The Netherlands and global average throughout the years 1980 - 2012 in Dobson units");

            d3.select("body").append("div").attr("class", "legend").attr("id", "legend-nl")

            d3.select("body").append("span").text("Netherlands")

            d3.select("body").append("br")
            d3.select("body").append("br")

            d3.select("body").append("div").attr("class", "legend").attr("id", "legend-world")

            d3.select("body").append("span").text("Global")

            // Width and height
			      const w = 950;
			      const h = 400;
            const barPadding = 5;


            const years = [];
            const ozoneNL = []; // ??? dit lelijk naar lijst pushen? houden in json?
            const ozoneWorld = [];
            var ozoneData = d3.json("data.json")
            ozoneData.then(function(data) {
              console.log(data);
              Object.values(data).forEach(function(d) {
                ozoneNL.push(d.Netherlands)
              })
              Object.values(data).forEach(function(d) {
                ozoneWorld.push(d.World)
              })
              Object.keys(data).forEach(function(d) {
                years.push(d)
              })


              // margins
              const margin = { top: 20, right: 40, bottom: 30, left: 40 };
              const innerWidth = w - margin.right - margin.left;
              const innerHeight = h - margin.top - margin.bottom;

              // x and y axes
              console.log(d3.min(years))
              console.log(d3.max(years))

              const xScale = d3.scaleBand()
                .domain(years)
                .range([0, innerWidth])


              // const yScale = d3.scaleLinear()
              //  .domain([0, d3.max(ozoneData, function(d,i) {
              //    return d.Netherlands
              //  })])
              //  .range([innerHeight,0]).nice();

              const yScale = d3.scaleLinear()
               .domain([0, d3.max(ozoneNL)])
               .range([innerHeight+20,20]).nice(); // remove hardcode !!!

              // Create div to show values
              const div = d3.select("body").append("div")
                .attr("class", "tooltip-donut")
                .style("opacity", 0);


              //Create SVG element
                    const svg = d3.select("body")
                          .append("svg")
                          .attr("width", w)
                          .attr("height", h);

                    const rectanglesWorld = svg.selectAll(".worldBar")
                        .data(Object.keys(data))
                        .enter()
                        .append("rect")
                        .attr("class", "worldBar")

                        rectanglesWorld.attr("x", function(d, i) {
                              return i * (innerWidth/years.length) + 30 + (innerWidth / years.length - barPadding) / 2; // remove this hardcode
                            })
                             .attr("y", function(d) {
                               return (innerHeight+20-data[d]["World"]) // !!! remove hardcode ??? dit beste manier? want gaat ook beetje naar beneden zo
                             })
                             .attr("width", (innerWidth / years.length - barPadding) / 2)
                             .attr("height", function(d) {
                              return data[d]["World"];
                            })
                            .attr("fill", "#3399ff")
                            // Add hover effect on mouse over
                            .on('mouseover', function (d, i) {
                              d3.select(this).transition()
                              .duration('50')
                              .attr('opacity', '.8')

                            //Makes the new div appear on hover for world data:

             div.transition()
                  .duration(50)
                  .style("opacity", 1)
                  div.html(data[d]["World"])
        .style("left", (d3.event.pageX + 10) + "px")
        .style("top", (d3.event.pageY - 15) + "px")
   })
                            // Disable hover effect on mouse out
                            .on('mouseout', function (d, i) {
                              d3.select(this).transition()
                              .duration('50')
                              .attr('opacity', '1');


                            //Makes the new div disappear:
             div.transition()
                  .duration('50')
                  .style("opacity", 0);
   });


                    const rectanglesNL = svg.selectAll(".nedBar")
                        .data(Object.keys(data))
                        .enter()
                        .append("rect")
                        .attr("class", "nedBar")


                    rectanglesNL.attr("x", function(d, i) {
                          return i * (innerWidth/years.length) + 30; // remove this hardcode
                        })
                         .attr("y", function(d) {
                           return (innerHeight+20-data[d]["Netherlands"]) // !!! remove hardcode ??? dit beste manier? want gaat ook beetje naar beneden zo
                         })
                         .attr("width", (innerWidth / years.length - barPadding) / 2)
                         .attr("height", function(d) {
                          return data[d]["Netherlands"];
                        })
                        .attr("fill", "lightblue")

                         // Add hover effect on mouse over
                         .on('mouseover', function (d, i) {
                           d3.select(this).transition()
                           .duration('50')
                           .attr('opacity', '.85')

                         //Makes the new div appear on hover:

          div.transition()
               .duration(50)
               .style("opacity", 1)
               div.html(data[d]["Netherlands"])
     .style("left", (d3.event.pageX + 10) + "px")
     .style("top", (d3.event.pageY - 15) + "px")
})
                         // Disable hover effect on mouse out
                         .on('mouseout', function (d, i) {
                           d3.select(this).transition()
                           .duration('50')
                           .attr('opacity', '1');


                         //Makes the new div disappear:
          div.transition()
               .duration('50')
               .style("opacity", 0);
});
//   axes
  const xAxis = svg.append("g")
    .classed("xAxis", true)
    .attr('transform', `translate(30,${innerHeight + 20})`) // !!! remove hardcode ??? wat hier in de translate?
    .call(d3.axisBottom(xScale))
    .selectAll("text")
             .attr("y", 0)
             .attr("x", 9)
             .attr("dy", ".35em")
             .attr("transform", "rotate(60)")
             .style("text-anchor", "start"); // !!! retype?

    const yAxis = svg.append("g")
      .classed("yAxis", true)
      .attr('transform', `translate(30,${0})`) // ??? wat hier in de translate?
      .call(d3.axisLeft(yScale))


            });

            // !!! kloppen verhoudingen wel?

        </script>
    </body>
</html>
